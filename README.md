# MyVPN - Простой VPN протокол на Go

VPN сервер с TUN интерфейсом и шифрованием ChaCha20-Poly1305.

## Требования

- Go 1.21 или выше
- Linux система с правами root/sudo (для работы с TUN интерфейсом и iptables)
- Утилиты `ip` и `iptables` для настройки сети

## Установка

### Компиляция сервера и клиента

```bash
# Компиляция сервера
go build -o myvpn-server ./cmd/server

# Компиляция клиента
go build -o myvpn-client ./cmd/client
```

### Запуск сервера

```bash
sudo ./myvpn-server -addr :8080
```

Сервер автоматически:
- Создаст TUN интерфейс `myvpn0` с IP `10.0.0.1/24`
- Включит IP forwarding
- Настроит NAT (MASQUERADE) для VPN подсети
- Добавит правила iptables для FORWARD


```
### Использование предустановленного ключа

```bash
# Создайте файл с ключом (32 байта)
echo "1a2b3c4d5e6f7890abcdef1234567890abcdef1234567890abcdef1234567890" | xxd -r -p > key.bin

# Или сгенерировать случайный ключ
dd if=/dev/urandom of=key.bin bs=1 count=32

# Запустите сервер с ключом
sudo ./myvpn-server -addr :8080 -key key.bin
```

### Запуск клиента

```bash
sudo ./myvpn-client -server SERVER_IP:8080 -key key.bin -ip 10.0.0.2
```

Клиент автоматически:
- Создаст TUN интерфейс `myvpn0` с указанным IP
- Настроит маршрутизацию всего трафика через VPN (если `-auto-routes=true`)
- При отключении восстановит оригинальные маршруты

**Пример:**
```bash
sudo ./myvpn-client -server 192.168.1.100:8080 -key key.bin -ip 10.0.0.2
```

### Параметры сервера

- `-addr` - адрес для прослушивания (по умолчанию: `:8080`)
- `-key` - путь к файлу с ключом шифрования (32 байта). Если не указан, будет сгенерирован случайный ключ
- `-verbose` - подробное логирование пакетов
- `-pprof` - адрес для pprof HTTP сервера (по умолчанию: `:6060`, пустая строка отключает)
- `-metrics` - адрес для метрик HTTP сервера (по умолчанию: `:6061`, пустая строка отключает)

### Параметры клиента

- `-server` - адрес VPN сервера (обязательно, например: `192.168.1.100:8080`)
- `-key` - путь к файлу с ключом шифрования (32 байта, обязательно)
- `-ip` - IP адрес для TUN интерфейса клиента (по умолчанию: `10.0.0.2`)
- `-auto-routes` - автоматическая настройка маршрутов (по умолчанию: `true`)
- `-verbose` - подробное логирование пакетов
- `-pprof` - адрес для pprof HTTP сервера (по умолчанию: `:6060`, пустая строка отключает)

## Архитектура

- **TUN интерфейс**: Создает виртуальный сетевой интерфейс `myvpn0`
- **Шифрование**: ChaCha20-Poly1305 (AEAD) с случайным nonce для каждого пакета
- **Сжатие**: LZ4 для пакетов > 64 байт (если сжатие эффективно)
- **Протокол**: UDP с keepalive пакетами
